@model Web.ViewModels.SearchingViewModel

<!DOCTYPE html>
<html lang="en">
<head>
	<title>Game Search</title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="/css/gameList.css" />
	<link rel="stylesheet" href="/css/buttons.css" />
	<link rel="stylesheet" href="/css/site.css" />
</head>
<body>
	<form class="form-inline my-2 my-lg-0" asp-action="SearchGame">

		<input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" name="SearchString">

		<button class="btn btn-info my-2 my-sm-0" type="submit">Search</button>

		<div class="dropdown">
			<button class="btn btn-secondary dropdown-toggle drpdwn-genres" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				Genre
			</button>
			<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">

				@foreach (var genre in Model.Genres)
				{
					<a class="dropdown-item" asp-action="FilterGamesByGenre" asp-route-gameGenreId="@genre.Id">@genre.Name</a>
				}

			</div>
		</div>
	</form>

	@if (@ViewBag.searchString != null)
	{
		<h2>Search Results for '@ViewBag.searchString'</h2>	
	}

	<div class="game-cards" style="margin-top:24px;">
		<div class="row">
			@foreach (var item in Model.Games)
			{
				<div class="col-sm-3">
					<div class="card @*border-0*@">
						<a class="btn-link" asp-controller="Game" asp-action="GameDetails" asp-route-id="@item.Id">
							<img class="card-img-top" src="@item.HeaderImage" alt="Card image" style="width:100%">
						</a>
						<div class="card-body">
							<a class="btn-link" asp-controller="Game" asp-action="GameDetails" asp-route-id="@item.Id">
								<h4 class="card-title">@item.Name</h4>
							</a>
							<p class="card-text">
							<p>Release Date: @item.ReleaseDate.ToShortDateString()</p>
								@{
									var ratingScore = @item.Ratings.Select(x => x.GameRating).DefaultIfEmpty().Average();
								}
							<span style="">&#11088; @Math.Round(ratingScore, 1)</span>

								@if ((await AuthorizationService.AuthorizeAsync(User, "RequireAdministratorRole")).Succeeded)
								{
								<div class="btn-group dropup" style="position: absolute; top: 292px; left: 5%;">
									<button type="button" class="btn btn-dark dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
										Actions
									</button>
									<ul class="dropdown-menu">
										<li><a class="dropdown-item" asp-controller="AdminGenre" asp-action="DeleteGame" asp-route-id="@item.Id">Delete</a></li>
										<li><a class="dropdown-item" asp-controller="AdminGame" asp-action="EditGame" asp-route-id="@item.Id">Edit</a></li>
									</ul>
								</div>
								}
								@if (User.Identity.IsAuthenticated)
								{
								<a type="button" class="btn btn-success btn-action btn-add" asp-controller="UserLibrary" asp-action="AddGameToUserLibrary" asp-route-id="@item.Id">
									<i class="fa fa-plus-circle" aria-hidden="true"></i>
									<span class="@*action-text*@ add-text">Add</span>
								</a>
								}
						</div>
					</div>
				</div>
			}
		</div>
	</div>
</body>
</html>
